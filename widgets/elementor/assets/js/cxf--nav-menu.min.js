"use strict";

var cxfHamburgetBtn = document.querySelector(".cxf-menu-hamburger");
var cxfMenuWrapper = document.querySelector(".cxf-menu-wrapper");
var cxfMenuOverlay = document.querySelector(".cxf-menu-overlay");

function cxfMobileMenu() {
  if (cxfHamburgetBtn) {
    var windowWidth = window.innerWidth;
    let breakpoint = cxfHamburgetBtn.hasAttribute("data-breakpoint")
      ? cxfHamburgetBtn.getAttribute("data-breakpoint")
      : "";
    let widgetId = cxfHamburgetBtn.hasAttribute("data-id")
      ? cxfHamburgetBtn.getAttribute("data-id")
      : "";
    var menu = document.querySelector(
      `[data-id="${widgetId}"] .cxf-menu-wrapper`
    );

    if (breakpoint && windowWidth < breakpoint) {
      menu.classList.add("mobile-menu");
    } else {
      menu.classList.remove("mobile-menu");
    }

    if (
      cxfMenuWrapper &&
      cxfMenuWrapper.classList.contains("toggle-mobile-menu")
    ) {
      cxfMenuWrapper.classList.remove("toggle-mobile-menu");
    }

    if (cxfMenuOverlay && cxfMenuOverlay.classList.contains("show")) {
      cxfMenuOverlay.classList.remove("show");
    }
  }
}

function cxfAdjustWpAdminBar() {
  var wp_admin_bar = document.getElementById("wpadminbar");
  var cxf_nav_menu = document.querySelector(".cxf-menu-nav");

  if (!cxf_nav_menu) {
    return;
  }

  cxf_nav_menu.style.top = "0px";

  if (wp_admin_bar) {
    cxf_nav_menu.style.top = wp_admin_bar.offsetHeight + "px";
  }
}

cxfMobileMenu();

window.addEventListener("resize", (event) => cxfMobileMenu());

document.addEventListener("DOMContentLoaded", function () {
  var cxfMobileMenuItems = document.querySelectorAll(
    ".cxf-menu-wrapper.mobile-menu .menu-item-has-children"
  );
  var cxfMobileMenuItemSubMenu = document.querySelector(
    ".cxf-menu-wrapper.mobile-menu .menu-item-has-children > .sub-menu"
  );

  cxfAdjustWpAdminBar();

  if (cxfHamburgetBtn) {
    cxfHamburgetBtn.addEventListener("click", function (event) {
      event.preventDefault();
      if (cxfMenuWrapper) {
        cxfMenuWrapper.classList.toggle("toggle-mobile-menu");
      }

      if (cxfMenuOverlay) {
        cxfMenuOverlay.classList.toggle("show");
      }
    });
  }

  if (cxfMobileMenuItems && cxfMobileMenuItems.length > 0) {
    cxfMobileMenuItems.forEach(function (cxfMobileMenuItem) {
      let submenu = cxfMobileMenuItem.querySelector(".menu-item-has-children .sub-menu");
      submenu.classList.remove("show");
      cxfMobileMenuItem.addEventListener("click", function (event) {
        cxfMobileMenuItems.forEach((menuItem) => {
          if (!menuItem.contains(event.target)) {
            menuItem.querySelector(".sub-menu").classList.remove("show");
          }
        });

        if (cxfMobileMenuItem.contains(event.target)) {
          submenu.classList.toggle("show");
        }
      });
    });
  }

  document.addEventListener("click", function ($event) {
    if (cxfMenuOverlay != $event.target) {
      return;
    }

    if (
      cxfMenuWrapper &&
      cxfMenuWrapper.classList.contains("toggle-mobile-menu")
    ) {
      cxfMenuWrapper.classList.remove("toggle-mobile-menu");
    }

    if (cxfMenuOverlay && cxfMenuOverlay.classList.contains("show")) {
      cxfMenuOverlay.classList.remove("show");
    }
  });
});
