"use strict";

window.addEventListener("elementor/init", () => {
  const styleSelectItemView = elementor.modules.controls.BaseData.extend({
    onReady() {
      const self = this;

      this.selected_style = "";

      const triggerBtn = this.$el.find(".style-select-trigger");
      const modalContainer = this.$el.find(".style-select-modal");
      const closeBtn = this.$el.find(".style-select-close");
      const styleSelectInput = this.$el.find(".style_select_input");
      const styleDropdown = this.$el.find("select.style-select-dropdown");
      const saveAndCloseModal = this.$el.find(".style-select-save");
      const selectThumbWrapper = this.$el.find(".style-select-thumb-wrapper");

      triggerBtn.on("click", function (e) {
        if (!modalContainer.hasClass("show-modal")) {
          modalContainer.addClass("show-modal");
        }
      });

      selectThumbWrapper.on("click", function (e) {
        selectThumbWrapper.removeClass("active");
        jQuery(this).addClass("active");
      });

      styleSelectInput.on("change", function (e) {
        self.selected_style = jQuery(this).val();
        styleDropdown.val(self.selected_style).change();
        self.saveValue();
      });

      styleDropdown.on("change", function (e) {
        self.selected_style = jQuery(this).val();
        styleSelectInput
          .filter(`[value=${self.selected_style}]`)
          .prop("checked", true);
        self.saveValue();
      });

      saveAndCloseModal.on("click", function (e) {
        if (modalContainer.hasClass("show-modal")) {
          modalContainer.removeClass("show-modal");
        }
        self.saveValue();
      });

      closeBtn.on("click", function (e) {
        if (modalContainer.hasClass("show-modal")) {
          modalContainer.removeClass("show-modal");
        }
      });
    },
    saveValue() {
      this.setValue(this.selected_style);
    },
    onBeforeDestroy() {
      this.saveValue();
    },
  });

  elementor.addControlView("style_select", styleSelectItemView);
});
